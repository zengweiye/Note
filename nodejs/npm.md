### `npm`

### `npm`模块安装机制

1. 发出 `npm install`命令
2. 查询`node_moudles`目录之中是否已经存在指定模块，若存在，不再安装；若不存在，向`registry`查询模块压缩包的网址
3. 下载压缩包，存放在根目录下的`.npm`目录下
4. 解压压缩包到当前项目的`node_moudles`目录



### `npm`实现原理

1. 执行工程自身`preinstall`，并执行`preinstall`钩子
2. 确定首层依赖模块，首先需要做的是确定工程中的首层依赖，`dependencies`和`devDependencies`属性中直接指定的模块。每个首层依赖都是根节点下面的一颗子树，`npm`会开启多进程从每个首层依赖模块开始逐步寻找更深层级的节点
3. 递归获取模块
   1. 获取模块信息。确定其版本，如果描述文件中有该模块信息，直接获取；如果没有则从仓库获取。
   2. 获取实体。获取模块信息时会获取到模块的压缩包地址，`npm`会检查缓存，如果缓存有则直接获取，没有则从仓库中下载
   3. 查看该模块的依赖，如果还需要其他依赖，则重复第一步
4. 安装模块，这一步会更新工程中的`node_moudles`，并执行模块中的生命周期函数
5. 执行工程生命周期，以及执行生命周期钩子。



### `npm`钩子命令

1. `preinstall`

   在执行`npm install`命令时，`preinstall`指向的脚本将会被加载执行

2. `install`

   在`preinstall`执行后，将会执行`install`钩子

3. `uninstall`

   在执行`npm uninstall`命令时触发钩子

4. `test`

   在执行`npm test`命令时触发钩子



